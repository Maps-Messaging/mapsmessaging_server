services:
  maps-messaging:
    image: maps-messaging/server:latest
    container_name: maps-messaging-server
    ports:
      - "9000:9000/tcp"   # Main messaging protocol
      - "8080:8080/tcp"   # REST API and Admin UI
      - "8778:8778/tcp"   # Jolokia JMX
      - "4222:4222/tcp"   # NATS protocol
      - "1883:1883/tcp"   # MQTT protocol
      - "1884:1884/udp"   # MQTT-SN protocol
      - "5683:5683/udp"   # CoAP protocol
      - "2442:2442/udp"   # MQTT-SN V2
    volumes:
      # Mount authentication configuration files
      - ./docker-config/AuthManager.yaml:/opt/maps/conf/AuthManager.yaml:ro
      - ./docker-config/SecurityManager.yaml:/opt/maps/conf/SecurityManager.yaml:ro
      - ./docker-config/jaasAuth.config:/opt/maps/conf/jaasAuth.config:ro
      - ./docker-config/RestApi.yaml:/opt/maps/conf/RestApi.yaml:ro
      
      # Mount persistent data directory
      - maps-data:/data
    environment:
      - MAPS_HOME=/opt/maps
      - MAPS_DATA=/data
      - JAVA_OPTS=-Xmx2g -Xms1g
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/v1/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  maps-data:
    driver: local