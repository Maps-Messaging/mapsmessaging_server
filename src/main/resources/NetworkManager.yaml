#
# Copyright [ 2020 - 2024 ] [Matthew Buckton]
# Copyright [ 2024 - 2025 ] [Maps Messaging B.V.]
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.
#

---
NetworkManager:
    global:

      # ---------------------------------------------------------------------------------------------------------
      # tcp layer configuration
      # ---------------------------------------------------------------------------------------------------------
      receiveBufferSize: 128000
      sendBufferSize: 128000
      timeout: 60000
      backlog: 100
      soLingerDelaySec: 10
      readDelayOnFragmentation: 100
      fragmentationLimit: 5
      enableReadDelayOnFragmentation: true

      # ---------------------------------------------------------------------------------------------------------
      # Generic protocol configuration
      # ---------------------------------------------------------------------------------------------------------
      serverReadBufferSize: 100K
      serverWriteBufferSize: 100K
      selectorThreadCount: 10

      # ---------------------------------------------------------------------------------------------------------
      # MQTT Protocol configuration
      # ---------------------------------------------------------------------------------------------------------
      maximumSessionExpiry: 86400
      maximumBufferSize: 10M
      serverReceiveMaximum: 10
      clientReceiveMaximum: 65535
      clientMaximumTopicAlias: 32767
      serverMaximumTopicAlias: 0
      strictClientId: false

      # ---------------------------------------------------------------------------------------------------------
      # MQTT 5.0 specific
      # ---------------------------------------------------------------------------------------------------------
      minServerKeepAlive: 0
      maxServerKeepAlive: 60

      # ---------------------------------------------------------------------------------------------------------
      # LoRa Gateway specific
      # ---------------------------------------------------------------------------------------------------------
      # Maximum Packets per second limit to ensure the radio isn't flooded
      LoRaMaxTransmissionRate: 20

      # ---------------------------------------------------------------------------------------------------------
      # MQTT-SN specific configuration
      # ---------------------------------------------------------------------------------------------------------
      maxInFlightEvents: 1
      dropQoS0Events: true
      eventQueueTimeout: 0
      advertiseGateway: false
      enablePortChanges: true
      enableAddressChanges: true
      packetReuseTimeout: 1000

      # ---------------------------------------------------------------------------------------------------------
      # Global configuration
      # ---------------------------------------------------------------------------------------------------------
      discoverable: true             # If the server registers a mdns entry for the adapter
      preferIPv6Addresses: true      # If the server should prefer IPv6 addresses over IPv4 addresses
      scanNetworkChanges: true      # If true, the server will scan for new interfaces or disconnected interfaces
      scanInterval: 60000            # Time in milliseconds to scan for network changes

        # ---------------------------------------------------------------------------------------------------------
        # Global configuration for SSL
        # ---------------------------------------------------------------------------------------------------------
      security:
        tls:
          clientCertificateRequired: false
          clientCertificateWanted: false
            #-----------------------------------
            # CRL Specific
            # crlUrl: <URL TO CRL>
            # crlInterval: <time in seconds to reload CRL>
            #-----------------------------------

          keyStore:
            type: JKS
            managerFactory: SunX509
            path: my-keystore.jks
            passphrase: password

          trustStore:
            type: JKS
            path: my-truststore.jks
            passphrase: password
            managerFactory: SunX509

        dtls:
          clientCertificateRequired: false

          keyStore:
            type: JKS
            managerFactory: SunX509
            path: my-keystore.jks
            passphrase: password

          trustStore:
            type: JKS
            path: my-truststore.jks
            passphrase: password
            managerFactory: SunX509

    data:

      - name: "MQTT Interface"
        url: tcp://:::1883/
        protocol: mqtt
        auth: usernamePassword
        selectorThreadCount: "{processors}/2"

      - name: "MQTT SSL Interface"
        url: "ssl://0.0.0.0:1892/"
        protocol: mqtt, ws
        auth: default

      - name: "NATS Interface"
        url: "tcp://0.0.0.0:4222/"
        protocol: nats
        enableStreams: true
        auth: default

      - name: "Stomp Interface with WebSocket Support"
        url: "tcp://0.0.0.0:8675/"
        protocol: stomp,ws
        auth: default

      - name: "Stomp Interface - Authenticated Stomp over SSL"
        url: "ssl://0.0.0.0:8695/"
        protocol: stomp,wss
        auth: default

      - name: "AMQP Interface"
        url: "tcp://0.0.0.0:5672/"
        protocol : amqp
        auth: default

      - name: "AMQP anon ssl Interface"
        url: "ssl://0.0.0.0:5692/"
        protocol: amqp
        auth: default

      - name: "MQTT-SN Interface"
        url: udp://0.0.0.0:1887/
        protocol: mqtt-sn
        eventsPerTopicDuringSleep: 10
        maxTopicsInSleep: 10
        advertiseGateway: true
        enablePortChanges: true
        enableAddressChanges: true
        auth: default

      - name: "DTLS MQTT-SN Interface"
        url: dtls://0.0.0.0:1886/
        protocol: mqtt-sn
        eventsPerTopicDuringSleep: 10
        maxTopicsInSleep: 10
        advertiseGateway: true
        auth: default

      - name: "CoAP Interface"
        url: udp://0.0.0.0:5683/
        protocol: coap
        maxBlockSize: 512
        idleTimePeriod: 120
        auth: default

      - name: "DTLS CoAP Interface"
        url: dtls://0.0.0.0:5684/
        protocol: coap
        maxBlockSize: 512
        ssl_SSLContext: DTLS
        auth: default


#      - name: "Inmarsat Iot nano interface"
#        protocol: satellite
#        auth: anon
#        url: satellite://inmarsat:0/
#        httpRequestTimeoutSec: 30
#        pollInterval: 15
#        sharedSecret: "This is a shared secret to use"
#        maxInflightEventsPerDevice: 2
#        outboundNamespaceRoot: "/inmarsat/{deviceId}"
#        outboundBroadcast: "/inmarsat/broadcast"
#        baseUrl: "https://api.inmarsat.com/iotMessaging/v1"
#        remoteAuthConfig:
#          username: ""
#          password: ""
#
#        mailboxId: ""
#        mailboxPassword: ""
#        namespaceRoot: "/{mailboxId}/"



#      - name: "OrbComm OGWS interface"
#        protocol: satellite
#        auth: anon
#        url: satellite://orbcomm:0/
#        httpRequestTimeoutSec: 30
#        pollInterval: 7
#        sharedSecret: "This is a shared secret to use"
#        maxInflightEventsPerDevice: 2
#        outboundNamespaceRoot: "/orbcomm/{deviceId}"
#        outboundBroadcast: "/orbcomm/broadcast"
#        baseUrl: "http://localhost:8081/api/v1.0"
#        maxBufferSize: 4000
#        compressionCutoffSize: 128

#        remoteAuthConfig:
#          username: ""
#          password: ""


#      - name: NMEA GPS port
#        url: serial://ttyUSB0,9600,8,N,1/
#        port: ttyUSB0
#        baudRate: 9600
#        dataBits: 8
#        stopBits: 1
#        parity: n
#        protocol: NMEA
#        selectorThreadCount: 1
